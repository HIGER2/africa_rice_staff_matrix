import{r as Y,a as v,w as q,b as Z,e as n,o as r,f as e,g as _,h as T,v as k,u as i,i as H,F as m,j as f,t as d,k as O,l as S,T as j,n as x,m as K}from"./app-ZTUnDF1m.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";Y();const W={class:"p-7 w-full h-screen flex flex-col"},X={class:"flex-1"},ee={class:"w-full"},te={class:"overflow-x-auto border border-gray-200 rounded-lg overflow-y-auto min-h-10 max-h-[600px]"},oe={class:"min-w-max text-sm w-full border-collapse"},le={class:"bg-gray-200 sticky top-0"},se=["onClick"],ae={key:0,class:"fixed p-10 w-full inset-0 bg-black/50 bg-opacity-50 flex items-center justify-center"},ne={class:"bg-white flex flex-col w-[100%] p-3 px-5 rounded-xl shadow-xl overflow-hidden max-h-[90vh]"},re={class:"w-full"},ie={class:"text-lg font-semibold mb-4"},ce={class:"w-full flex items-center gap-3"},ue={class:"text-green-500"},de={key:0,class:"flex-1 overflow-y-auto"},me={key:0,class:"w-full flex items-center gap-1"},fe={class:"min-w-max"},pe={class:x([" borders flex gap-2 borders-gray-200  w-full"])},ge={class:"w-full text-center"},ve={class:"block mb-2 text-[12px] font-medium lowercase text-gray-700"},be={class:"relative w-full h-8"},_e=["disabled","onInput","onUpdate:modelValue"],Ae=["onClick"],he={key:1,class:"text-center mt-2 font-medium"},ye={class:"w-full"},we={class:"mt-3 flex justify-end gap-2"},xe={key:0},Ne={key:1},Ce={__name:"TableOne",props:{staff:Array},setup(U){const L=U;let A=v([]);const h=v([]);let b=v(!1),p=v("");const y=["id","employeeId","agreement","bus","year","date","total"],N={resno:"RESNO",name:"NAME",position:"POSITION",grade_level:"GRADE/LEVEL",grade:"GRADE",organization:"ORGANIZATION",country:"COUNTRY",base_station:"BASE STATION",division:"DIVISION",unit_program:"UNIT/PROGRAM",supervisor:"SUPERVISOR"},V={jan:"JAN",feb:"FEB",apr:"APR",mar:"MAR",may:"MAY",jun:"JUN",jul:"JUL",aug:"AUG",sep:"SEP",oct:"OCT",nov:"NOV",dec:"DEC"},D={agreement:"AGREEMENT",bus:"BUS",jan:"JAN",feb:"FEB",apr:"APR",mar:"MAR",may:"MAY",jun:"JUN",jul:"JUL",aug:"AUG",sep:"SEP",oct:"OCT",nov:"NOV",dec:"DEC",total:"Total"},M={id:null,agreement:0,bus:0,jan:0,feb:0,apr:0,mar:0,may:0,jun:0,jul:0,aug:0,sep:0,oct:0,nov:0,dec:0,total:0};let s=v(null);const P=(t,l)=>{const a=Object.keys(s.value.timeAllocations[l]).filter(o=>{if(!y.includes(o))return o}).reduce((o,c)=>(s.value.timeAllocations[l][c]&&(o+=s.value.timeAllocations[l][c]),o),0);s.value.timeAllocations[l].total=a,console.log(s.value.timeAllocations[l])};function z(t){s.value={...t,timeAllocations:[...t.timeAllocations]}}function B(){s.value=null}const C=(t,l)=>`${t.reduce((o,c)=>(c[l]&&(o+=Number(c[l])),o),0)}%`;function G(){console.log(s.value.timeAllocations),s.value.timeAllocations.unshift({...M})}function J(t){if(!confirm("Confirm ?"))return;let l={...s.value};b.value=!0,axios.post("/time-allocations",{employeeId:l.employeeId,timeAllocations:l.timeAllocations}).then(a=>{alert("Allocations saved successfully"),console.log("Allocations saved successfully",a.data.data.time_allocations),s.value.timeAllocations=[...a.data.data.time_allocations],b.value=!1}).catch(a=>{var o;alert("Error saving allocations"),console.error("Error saving allocations:",((o=a.response)==null?void 0:o.data)||a.message),b.value=!1})}function $(t){s.value.timeAllocations.splice(t,1)}function F(t,l){return y.includes(t)?0:l?`${l>100?100:l}%`:0}return q(p,t=>{const l=t.toLowerCase();A.value=h.value.filter(a=>a.name.toLowerCase().includes(l)||a.resno.toLowerCase().includes(l))}),Z(()=>{h.value=L.staff.map(t=>({employeeId:t.employeeId,resno:t.resno||"N/A",name:t.name+" "+t.lastName,position:t.position||"N/A",grade_level:t.grade_level||"N/A",grade:t.grade||"N/A",organization:t.organization||"N/A",country:t.country||"N/A",base_station:t.base_station||"N/A",division:t.division||"N/A",unit_program:t.unit_program||"N/A",supervisor:t.supervisor&&`${t.supervisor.firstName||""} ${t.supervisor.lastName||""}`.trim()||"N/A",timeAllocations:t.time_allocations})),A.value=[...h.value]}),(t,l)=>(r(),n("div",W,[l[4]||(l[4]=e("h1",{class:"text-xl font-bold mb-4"},"Staff Time Allocation",-1)),e("div",X,[e("div",ee,[T(e("input",{"onUpdate:modelValue":l[0]||(l[0]=a=>H(p)?p.value=a:p=a),class:"border border-gray-300 p-2 rounded-lg w-full mb-3",type:"text",placeholder:"search...",name:"",id:""},null,512),[[k,i(p)]])]),e("div",te,[e("table",oe,[e("thead",le,[e("tr",null,[(r(),n(m,null,f(N,(a,o)=>e("th",{key:o,class:"px-4 py-2 border text-[11px] border-gray-300 text-left whitespace-nowrap"},d(a),1)),64))])]),e("tbody",null,[(r(!0),n(m,null,f(i(A),(a,o)=>(r(),n("tr",{key:o,class:"hover:bg-blue-100 cursor-pointer",onClick:c=>z(a)},[(r(),n(m,null,f(N,(c,g)=>e("td",{key:g,class:"px-4 py-3 border-b text-[12px] bg-white border-gray-200 whitespace-nowrap"},d(a[g]),1)),64))],8,se))),128))])])])]),i(s)?(r(),n("div",ae,[e("div",ne,[e("div",re,[e("h2",ie,"Staff Time Allocation : "+d(i(s).name),1),e("button",{onClick:G,class:"p-1 px-2 mb-2 bg-green-500 text-white cursor-pointer rounded hover:bg-green-400"}," + Add new "),e("div",ce,[(r(),n(m,null,f(V,(a,o)=>e("div",{key:o,class:"flex items-center gap-1 py-3 font-medium text-[12px]"},[e("span",ue,d(a)+" :",1),O(j,{name:"fade-slide",mode:"out-in"},{default:S(()=>[(r(),n("span",{key:C(i(s).timeAllocations,a.toLocaleLowerCase())},d(C(i(s).timeAllocations,a.toLocaleLowerCase())),1))]),_:2},1024)])),64))])]),i(s).timeAllocations.length>0?(r(),n("div",de,[(r(!0),n(m,null,f(i(s).timeAllocations,(a,o)=>{var c,g,E,I;return r(),n("div",{class:"w-full",key:o},[i(s).timeAllocations[o].date?(r(),n("div",me,[l[1]||(l[1]=e("div",{class:"w-full rounded-full h-[1px] bg-gray-300"},null,-1)),e("div",fe,d(i(s).timeAllocations[o].date),1),l[2]||(l[2]=e("div",{class:"w-full rounded-full h-[1px] bg-gray-300"},null,-1))])):_("",!0),e("div",pe,[e("div",{class:x(["flex w-full  items-start p-2 rounded-md  cursor-pointer  mb-2 hover:bg-blue-50",(g=(c=i(s).timeAllocations)==null?void 0:c[o])!=null&&g.id?"bg-gray-100 ":"bg-red-50"])},[(r(),n(m,null,f(D,(R,u)=>e("div",ge,[e("label",ve,d(R),1),e("div",be,[e("div",{class:"absolute inset-0 bg-green-300 transition-all duration-200 rounded",style:K({width:F(u,i(s).timeAllocations[o][u]),zIndex:0})},null,4),T(e("input",{type:"number",min:"0",max:"100",disabled:u=="total",class:x([[{"bg-yellow-400":u=="total"}],"relative z-10 w-full h-full border text-center text-sm border-gray-300 focus:outline-none focus:ring-2 focus:rounded-md focus:ring-green-500 focus:border-green-500"]),onInput:w=>P(w.target.value,o),"onUpdate:modelValue":w=>i(s).timeAllocations[o][u]=w},null,42,_e),[[k,i(s).timeAllocations[o][u]]])]),O(j,{name:"fade-slide",mode:"out-in"},{default:S(()=>[y.includes(u)?_("",!0):(r(),n("span",{key:i(s).timeAllocations[o][u],class:"text-[11px] font-bold block"},d(i(s).timeAllocations[o][u])+"% ",1))]),_:2},1024)])),64))],2),(I=(E=i(s).timeAllocations)==null?void 0:E[o])!=null&&I.id?_("",!0):(r(),n("button",{key:0,onClick:R=>$(o),type:"button",class:"p-1 cursor-pointer"},"x",8,Ae))])])}),128))])):(r(),n("div",he,l[3]||(l[3]=[e("span",null,"No Data",-1)]))),e("div",ye,[e("div",we,[e("button",{class:"px-3 p-1 cursor-pointer bg-gray-100 border border-gray-300 rounded hover:bg-gray-400",onClick:B}," cancel "),e("button",{class:"px-3 py-1 cursor-pointer border-0 bg-blue-600 text-white rounded hover:bg-blue-700",onClick:J},[i(b)?(r(),n("div",xe,"Processing...")):(r(),n("span",Ne," Save now"))])])])])])):_("",!0)]))}},Re=Q(Ce,[["__scopeId","data-v-35fc53a4"]]);export{Re as default};
