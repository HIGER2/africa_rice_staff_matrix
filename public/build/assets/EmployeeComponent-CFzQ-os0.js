import{r as se,a as I,b as ne,w as ie,e as re,f as d,o as u,g as a,h as y,i as J,v as de,u as r,j as ue,F as x,k as _,t as p,l as ce,m as N,n as A,p as E,q as S,T as R,s as me,x as fe}from"./app-Dv92iDb_.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";se();const ge={class:"p-7 w-full h-screen flex flex-col"},ve={class:"flex-1"},be={class:"w-full"},he={class:"overflow-x-auto border border-gray-200 rounded-lg overflow-y-auto min-h-10 max-h-[600px]"},ye={class:"min-w-max text-sm w-full border-collapse"},xe={class:"bg-gray-200 sticky top-0"},_e=["onClick"],Ae={class:"bg-white flex flex-col w-[100%] p-3 px-5 rounded-xl shadow-xl overflow-hidden max-h-[90vh]"},we={class:"w-full relative"},Ie={class:"w-full flex items-center gap-2 text-[14px] py-3"},Ne={class:"font-semibold mb-4 uppercase"},Te={class:"capitalize text-gray-600"},Ce={class:"font-semibold mb-4 uppercase"},ke={class:"capitalize text-gray-600"},je={class:"font-semibold mb-4 uppercase"},Ee={class:"capitalize text-gray-600"},Se={class:"w-full flex items-center gap-2"},Re={class:"borders flex gap-2 borders-gray-200 w-full"},Oe={key:0,class:A(["flex w-full  items-start p-2 rounded-md  cursor-pointer "])},Me={class:"w-full flex items-center justify-center gap-1 text-[11px]"},De={class:"font-bold"},Ve={class:"w-full flex items-center justify-center gap-1 text-[11px]"},Le={key:0,class:"flex-1 overflow-y-auto"},Pe={class:"borders flex items-center gap-2 borders-gray-200 group w-full"},ze={class:"w-full text-center"},Ue={class:"block mb-2 text-[12px] font-medium lowercase text-gray-700"},$e={class:"relative w-full h-8"},Be=["type","disabled","onInput","onUpdate:modelValue"],Ge=["onClick"],Fe=["onClick"],Ye={key:1,class:"text-center flex flex-col items-center gap-2 mt-2 font-medium"},Je={class:"w-full"},qe={class:"mt-3 flex justify-end gap-2"},Ze={key:0,class:"flex items-center gap-1"},He={key:1},Ke={key:0,class:"flex items-center gap-1"},Qe={key:1},We={__name:"EmployeeComponent",props:{staff:Array},setup(q){const Z=q;let v=I([]);const g=I([]);let f=ne({send:!1,save:!1,delete:!1});const O=I(null);let w=I("");const T=["id","employeeId","agreement","bus","year","date","total"];Array.prototype.isAnyExcluded=function(t){return t.some(e=>this.includes(e))};const M={resno:"RESNO",name:"NAME",position:"POSITION",grade_level:"GRADE/LEVEL",grade:"GRADE",organization:"ORGANIZATION",country:"COUNTRY",base_station:"BASE STATION",division:"DIVISION",unit_program:"UNIT/PROGRAM",supervisor:"SUPERVISOR"},D={agreement:"AGREEMENT",bus:"BUS",jan:"JAN",feb:"FEB",apr:"APR",mar:"MAR",may:"MAY",jun:"JUN",jul:"JUL",aug:"AUG",sep:"SEP",oct:"OCT",nov:"NOV",dec:"DEC"},H={id:null,agreement:0,bus:0,jan:0,feb:0,mar:0,apr:0,may:0,jun:0,jul:0,aug:0,sep:0,oct:0,nov:0,dec:0,total:0},K={id:null,jan:0,feb:0,mar:0,apr:0,may:0,jun:0,jul:0,aug:0,sep:0,oct:0,nov:0,dec:0,total:0};let o=I(null);const Q=(t,e)=>{const l=Object.keys(o.value.timeAllocations[e]).filter(n=>{if(!T.includes(n))return n}).reduce((n,i)=>(o.value.timeAllocations[e][i]&&(n+=o.value.timeAllocations[e][i]),n),0);o.value.timeAllocations[e].total=l,o.value.monthlyTotal={...o.value.monthlyTotal,...P(o.value.timeAllocations)},console.log(o.value.timeAllocations[e])};function W(t){o.value={...t,timeAllocations:[...t.timeAllocations]}}function C(){o.value=null}function V(t,e){return T.includes(e)?"":t.reduce((l,n)=>(n[e]&&(l+=Number(n[e])),l),0)}const X=(t,e)=>["agreement","bus"].includes(e)?"":`${t}:`;function L(){o.value.timeAllocations.unshift({...H}),o.value.timeAllocations.length==1&&(o.value.monthlyTotal={...K})}function P(t){const e=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],l={};let n=0;for(const i of e){const s=t.reduce((c,b)=>c+(Number(b[i])||0),0);l[`${i}`]=s,n+=s}return l.total=n,l}function k(t){const l=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"].reduce((n,i)=>n+t.reduce((s,c)=>s+(c[i]||0),0),0);return console.log(l),l}function ee(t){if(o.value.timeAllocations.length===0)return alert("Please add a time allocation before submitting."),!1;if(!confirm("Are you sure you want to save these changes?"))return!1;let e={...o.value};f.save=!0,axios.post("/time-allocations",{employeeId:e.employeeId,timeAllocations:e.timeAllocations,monthlyTimeTotal:e.monthlyTotal}).then(l=>{var s;alert(((s=l==null?void 0:l.data)==null?void 0:s.message)||(l==null?void 0:l.message)),console.log("Allocations saved successfully",l.data.data.time_allocations);let n=v.value.findIndex(c=>c.employeeId==e.employeeId),i=g.value.findIndex(c=>c.employeeId==e.employeeId);g.value[i]={...e,timeAllocations:[...l.data.data.time_allocations],monthlyTotal:{...l.data.data.monthly_total}},v.value[n]={...g.value[i]},o.value.timeAllocations=[...l.data.data.time_allocations],o.value.monthlyTotal={...l.data.data.monthly_total}}).catch(l=>{var n,i,s;alert(((i=(n=l.response)==null?void 0:n.data)==null?void 0:i.message)||l.message),console.error("Error saving allocations:",((s=l.response)==null?void 0:s.data)||l.message)}).finally(()=>{f.save=!1})}function te(t,e){if(!confirm("Are you sure you want to delete these changes?"))return;let l={...o.value};O.value=t,f.delete=!0,axios.post("/time-delete",{employeeId:l.employeeId,id:t}).then(n=>{alert("Allocations delete successfully"),console.log("Allocations saved successfully",n.data.data.time_allocations);let i=v.value.findIndex(c=>c.employeeId==l.employeeId);console.log(i);let s=g.value.findIndex(c=>c.employeeId==l.employeeId);g.value[s]={...l,timeAllocations:[...n.data.data.time_allocations]},v.value[i]={...g.value[s]},o.value.timeAllocations=[...n.data.data.time_allocations],console.log(v.value[0])}).catch(n=>{var i,s,c;alert(((s=(i=n.response)==null?void 0:i.data)==null?void 0:s.message)||n.message),console.error("Error saving allocations:",((c=n.response)==null?void 0:c.data)||n.message)}).finally(()=>{f.delete=!1})}function le(t){if(o.value.timeAllocations.length===0)return alert("Please add a time allocation before submitting."),!1;if(k(o.value.timeAllocations)!=1200)return alert("⚠️ The total allocations must add up to exactly 1200.Please check your inputs before sending the email."),!1;if(!confirm("Do you really want to deny this email?"))return;f.send=!0;let e={...o.value};axios.post("/send-mail",{employeeId:e.employeeId}).then(l=>{var n;alert(((n=l==null?void 0:l.data)==null?void 0:n.message)||(l==null?void 0:l.message))}).catch(l=>{alert("Error send allocations")}).finally(()=>{f.send=!1})}function oe(t){o.value.timeAllocations.splice(t,1),o.value.monthlyTotal=P(o.value.timeAllocations),o.value.timeAllocations.length==0&&(o.value.monthlyTotal=null)}function ae(t,e){return T.includes(t)?0:e?`${e>100?100:e}%`:0}function z(t,e){let l=e=="total"?1200:100;return t<l?"bg-blue-500":t>l?"bg-red-500":"bg-green-300"}return ie(w,t=>{const e=t.toLowerCase();v.value=g.value.filter(l=>l.name.toLowerCase().includes(e)||l.resno.toLowerCase().includes(e))}),re(()=>{g.value=Z.staff.map(t=>{var e;return{employeeId:t.employeeId,resno:t.resno||"N/A",name:((e=t==null?void 0:t.lastName)==null?void 0:e.toLowerCase())+" "+(t==null?void 0:t.name.toLowerCase()),position:t.position||"N/A",grade_level:t.grade_level||"N/A",grade:t.grade||"N/A",organization:t.organization||"N/A",country:t.country||"N/A",base_station:t.base_station||"N/A",division:t.division||"N/A",unit_program:t.unit_program||"N/A",supervisor:t.supervisor&&`${t.supervisor.firstName.toLowerCase()||""} ${t.supervisor.lastName.toLowerCase()||""}`.trim()||"N/A",timeAllocations:t.time_allocations,monthlyTotal:t.monthly_total}}),v.value=[...g.value]}),(t,e)=>{var l,n;return u(),d("div",ge,[e[10]||(e[10]=a("h1",{class:"text-xl font-bold mb-4"},"Staff Time Allocation",-1)),a("div",ve,[a("div",be,[J(a("input",{"onUpdate:modelValue":e[0]||(e[0]=i=>ue(w)?w.value=i:w=i),class:"border border-gray-300 p-2 rounded-lg w-full mb-3",type:"search",placeholder:"search...",name:"",id:""},null,512),[[de,r(w)]])]),a("div",he,[a("table",ye,[a("thead",xe,[a("tr",null,[(u(),d(x,null,_(M,(i,s)=>a("th",{key:s,class:"px-4 py-2 border text-[11px] border-gray-300 text-left whitespace-nowrap"},p(i),1)),64))])]),a("tbody",null,[(u(!0),d(x,null,_(r(v),(i,s)=>(u(),d("tr",{key:s,class:"hover:bg-blue-100 cursor-pointer",onClick:c=>W(i)},[(u(),d(x,null,_(M,(c,b)=>a("td",{key:b,class:"px-4 py-3 border-b text-[12px] bg-white border-gray-200 whitespace-nowrap"},p(i[b]),1)),64))],8,_e))),128))])])])]),r(o)?(u(),d("div",{key:0,onClick:ce(C,["self"]),class:"fixed p-10 w-full inset-0 bg-black/50 bg-opacity-50 flex items-center justify-center"},[a("div",Ae,[a("div",we,[a("div",Ie,[a("h2",Ne,[e[1]||(e[1]=N("Staff : ")),a("span",Te,p(r(o).name),1)]),a("h2",Ce,[e[2]||(e[2]=N("Supervisor : ")),a("span",ke,p(r(o).supervisor),1)]),a("h2",je,[e[3]||(e[3]=N("Year : ")),a("span",Ee,p(new Date().getFullYear()),1)])]),a("button",{onClick:C,class:"p-2 absolute top-0 right-2 text-2xl cursor-pointer"},e[4]||(e[4]=[a("i",{class:"uil uil-times"},null,-1)])),((l=r(o).timeAllocations)==null?void 0:l.length)>0?(u(),d("button",{key:0,onClick:L,class:"p-1 px-2 mb-2 bg-green-500 text-white cursor-pointer rounded hover:bg-green-400"}," + Add new ")):y("",!0),a("div",Se,[a("div",Re,[((n=r(o).timeAllocations)==null?void 0:n.length)>0?(u(),d("div",Oe,[(u(),d(x,null,_(D,(i,s)=>a("div",Me,[a("span",De,p(X(i,s)),1),E(R,{name:"fade-slide",mode:"out-in"},{default:S(()=>[(u(),d("span",{class:A([z(V(r(o).timeAllocations,s))," px-1 font-medium"]),key:r(o).monthlyTotal[s]},p(V(r(o).timeAllocations,s)),3))]),_:2},1024)])),64)),a("div",Ve,[e[5]||(e[5]=a("span",{class:"font-bold"},"Total",-1)),E(R,{name:"fade-slide",mode:"out-in"},{default:S(()=>[(u(),d("span",{class:A([z(k(r(o).timeAllocations),"total")," px-1 font-medium"]),key:t.key},p(k(r(o).timeAllocations)),3))]),_:1})])])):y("",!0)])])]),r(o).timeAllocations.length>0?(u(),d("div",Le,[(u(!0),d(x,null,_(r(o).timeAllocations,(i,s)=>{var c,b,U,$,B,G,F,Y;return u(),d("div",{class:"w-full",key:s},[a("div",Pe,[a("div",{class:A(["flex w-full  items-start p-2 transition-all duration-75 rounded-md  cursor-pointer  mb-2 hover:bg-blue-50",(b=(c=r(o).timeAllocations)==null?void 0:c[s])!=null&&b.id?"bg-gray-100 ":"bg-red-50",r(f).delete&&O.value==(($=(U=r(o).timeAllocations)==null?void 0:U[s])==null?void 0:$.id)?"bg-red-300":""])},[(u(),d(x,null,_(D,(j,m)=>a("div",ze,[a("label",Ue,p(j),1),a("div",$e,[a("div",{class:"absolute inset-0 bg-green-300 transition-all duration-200 rounded",style:me({width:ae(m,r(o).timeAllocations[s][m]),zIndex:0})},null,4),J(a("input",{type:m=="agreement"||m=="bus"?"text":"number",min:"0",max:"100",disabled:m=="total"||r(f).delete,class:A([[{"bg-yellow-400":m=="total"}],"relative z-10 w-full h-full border text-center text-sm border-gray-300 focus:outline-none focus:ring-2 focus:rounded-md focus:ring-green-500 focus:border-green-500"]),onInput:h=>Q(h.target.value,s),"onUpdate:modelValue":h=>r(o).timeAllocations[s][m]=h},null,42,Be),[[fe,r(o).timeAllocations[s][m]]])]),E(R,{name:"fade-slide",mode:"out-in"},{default:S(()=>[T.includes(m)?y("",!0):(u(),d("span",{key:r(o).timeAllocations[s][m],class:"text-[11px] font-bold block"},p(r(o).timeAllocations[s][m])+"% ",1))]),_:2},1024)])),64))],2),a("div",null,[(G=(B=r(o).timeAllocations)==null?void 0:B[s])!=null&&G.id?y("",!0):(u(),d("button",{key:0,onClick:j=>oe(s),type:"button",class:"p-1 cursor-pointer"},"x ",8,Ge)),!r(f).delete&&((Y=(F=r(o).timeAllocations)==null?void 0:F[s])!=null&&Y.id)?(u(),d("button",{key:1,class:A(["cursor-pointer  group-hover:inline-block hidden","p-1 cursor-pointer"]),onClick:j=>{var m,h;return te((h=(m=r(o).timeAllocations)==null?void 0:m[s])==null?void 0:h.id)}},e[6]||(e[6]=[a("span",{class:"text-red-500"},[a("i",{class:"uil uil-trash-alt"})],-1)]),8,Fe)):y("",!0)])])])}),128))])):(u(),d("div",Ye,[e[7]||(e[7]=a("span",null,"No Data",-1)),a("button",{onClick:L,class:"p-1 px-2 mb-2 max-w-max border border-green-500 text-green-500 cursor-pointer rounded"}," + Add new ")])),a("div",Je,[a("div",qe,[a("button",{class:"px-3 p-1 cursor-pointer bg-gray-100 border border-gray-300 rounded hover:bg-gray-400",onClick:C}," cancel "),a("button",{class:"px-3 py-1 cursor-pointer border-0 bg-green-500 text-white rounded hover:bg-green-700",onClick:ee},[r(f).save?(u(),d("div",Ze,e[8]||(e[8]=[a("div",{class:"w-5 h-5 border-5 border-white border-t-transparent rounded-full animate-spin"},null,-1),N(" Processing...")]))):(u(),d("span",He," Save now"))]),a("button",{class:"px-3 py-1 cursor-pointer border-0 bg-blue-600 text-white rounded hover:bg-blue-700",onClick:le},[r(f).send?(u(),d("div",Ke,e[9]||(e[9]=[a("div",{class:"w-5 h-5 border-5 border-white border-t-transparent rounded-full animate-spin"},null,-1),N(" Processing...")]))):(u(),d("span",Qe," Send email"))])])])])])):y("",!0)])}}},tt=pe(We,[["__scopeId","data-v-b194f59b"]]);export{tt as default};
