import{r as H,a as h,w as K,b as Q,e as r,o as i,f as o,g as y,h as S,v as W,u as n,i as X,F as f,j as b,t as m,k as ee,l as A,n as w,m as D,p as L,T as M,q as te,s as oe}from"./app-B8P-M-W8.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";H();const ae={class:"p-7 w-full h-screen flex flex-col"},se={class:"flex-1"},ne={class:"w-full"},re={class:"overflow-x-auto border border-gray-200 rounded-lg overflow-y-auto min-h-10 max-h-[600px]"},ie={class:"min-w-max text-sm w-full border-collapse"},ue={class:"bg-gray-200 sticky top-0"},ce=["onClick"],de={class:"bg-white flex flex-col w-[100%] p-3 px-5 rounded-xl shadow-xl overflow-hidden max-h-[90vh]"},me={class:"w-full relative"},pe={class:"w-full flex items-center gap-2 text-[14px] py-3"},fe={class:"font-semibold mb-4 uppercase"},be={class:"capitalize text-gray-600"},ge={class:"font-semibold mb-4 uppercase"},ve={class:"capitalize text-gray-600"},he={class:"font-semibold mb-4 uppercase"},ye={class:"capitalize text-gray-600"},_e={class:"w-full flex items-center gap-2"},xe={class:"borders flex gap-2 borders-gray-200 w-full"},Ae={class:w(["flex w-full  items-start p-2 rounded-md  cursor-pointer "])},we={class:"w-full flex items-center justify-center gap-1 text-[11px]"},Te={class:"font-bold"},Ne={key:0,class:"flex-1 overflow-y-auto"},Ce={class:"borders flex gap-2 borders-gray-200 w-full"},Ie={class:"w-full text-center"},Ee={class:"block mb-2 text-[12px] font-medium lowercase text-gray-700"},Oe={class:"relative w-full h-8"},je=["type","disabled","onInput","onUpdate:modelValue"],ke=["onClick"],Re={key:1,class:"text-center flex flex-col items-center gap-2 mt-2 font-medium"},Se={class:"w-full"},De={class:"mt-3 flex justify-end gap-2"},Le={key:0,class:"flex items-center gap-1"},Me={key:1},Ve={__name:"TableOne",props:{staff:Array},setup(V){const z=V;let g=h([]);const p=h([]);let T=h(!1),v=h("");const N=["id","employeeId","agreement","bus","year","date","total"];Array.prototype.isAnyExcluded=function(t){return t.some(e=>this.includes(e))};const E={resno:"RESNO",name:"NAME",position:"POSITION",grade_level:"GRADE/LEVEL",grade:"GRADE",organization:"ORGANIZATION",country:"COUNTRY",base_station:"BASE STATION",division:"DIVISION",unit_program:"UNIT/PROGRAM",supervisor:"SUPERVISOR"},O={agreement:"AGREEMENT",bus:"BUS",jan:"JAN",feb:"FEB",apr:"APR",mar:"MAR",may:"MAY",jun:"JUN",jul:"JUL",aug:"AUG",sep:"SEP",oct:"OCT",nov:"NOV",dec:"DEC",total:"TOTAL"},U={id:null,agreement:0,bus:0,jan:0,feb:0,mar:0,apr:0,may:0,jun:0,jul:0,aug:0,sep:0,oct:0,nov:0,dec:0,total:0},$={id:null,jan:0,feb:0,mar:0,apr:0,may:0,jun:0,jul:0,aug:0,sep:0,oct:0,nov:0,dec:0,total:0};let l=h(null);const B=(t,e)=>{const s=Object.keys(l.value.timeAllocations[e]).filter(a=>{if(!N.includes(a))return a}).reduce((a,u)=>(l.value.timeAllocations[e][u]&&(a+=l.value.timeAllocations[e][u]),a),0);l.value.timeAllocations[e].total=s,l.value.monthlyTotal={...l.value.monthlyTotal,...k(l.value.timeAllocations)},console.log(l.value.timeAllocations[e])};function G(t){l.value={...t,timeAllocations:[...t.timeAllocations]}}function C(){l.value=null}const P=(t,e)=>{let s=["agreement","bus"];return console.log(e),s.includes(e)?"":`${t}%`},F=(t,e)=>["agreement","bus"].includes(e)?"":`${t}:`;function j(){l.value.timeAllocations.unshift({...U}),l.value.timeAllocations.length==1&&(l.value.monthlyTotal={...$})}function k(t){const e=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],s={};let a=0;for(const u of e){const c=t.reduce((_,x)=>_+(Number(x[u])||0),0);s[`${u}`]=c,a+=c}return s.total=a,s}function Y(t){if(!confirm("Confirm ?"))return;let e={...l.value};T.value=!0,axios.post("/time-allocations",{employeeId:e.employeeId,timeAllocations:e.timeAllocations,monthlyTimeTotal:e.monthlyTotal}).then(s=>{alert("Allocations saved successfully"),console.log("Allocations saved successfully",s.data.data.time_allocations);let a=g.value.findIndex(c=>c.employeeId==e.employeeId),u=p.value.findIndex(c=>c.employeeId==e.employeeId);p.value[u]={...e,timeAllocations:[...s.data.data.time_allocations],monthlyTotal:{...s.data.data.monthly_total}},g.value[a]={...p.value[u]},l.value.timeAllocations=[...s.data.data.time_allocations],l.value.monthlyTotal={...s.data.data.monthly_total}}).catch(s=>{var a;alert("Error saving allocations"),console.error("Error saving allocations:",((a=s.response)==null?void 0:a.data)||s.message)}).finally(()=>{T.value=!1})}function J(t){l.value.timeAllocations.splice(t,1),l.value.monthlyTotal=k(l.value.timeAllocations),l.value.timeAllocations.length==0&&(l.value.monthlyTotal=null)}function q(t,e){return N.includes(t)?0:e?`${e>100?100:e}%`:0}function Z(t,e){let s=e=="total"?1200:100;return t<s?"bg-blue-500":t>s?"bg-red-500":"bg-green-300"}return K(v,t=>{const e=t.toLowerCase();g.value=p.value.filter(s=>s.name.toLowerCase().includes(e)||s.resno.toLowerCase().includes(e))}),Q(()=>{p.value=z.staff.map(t=>{var e;return{employeeId:t.employeeId,resno:t.resno||"N/A",name:((e=t==null?void 0:t.lastName)==null?void 0:e.toLowerCase())+" "+(t==null?void 0:t.name.toLowerCase()),position:t.position||"N/A",grade_level:t.grade_level||"N/A",grade:t.grade||"N/A",organization:t.organization||"N/A",country:t.country||"N/A",base_station:t.base_station||"N/A",division:t.division||"N/A",unit_program:t.unit_program||"N/A",supervisor:t.supervisor&&`${t.supervisor.firstName.toLowerCase()||""} ${t.supervisor.lastName.toLowerCase()||""}`.trim()||"N/A",timeAllocations:t.time_allocations,monthlyTotal:t.monthly_total}}),g.value=[...p.value]}),(t,e)=>(i(),r("div",ae,[e[7]||(e[7]=o("h1",{class:"text-xl font-bold mb-4"},"Staff Time Allocation",-1)),o("div",se,[o("div",ne,[S(o("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>X(v)?v.value=s:v=s),class:"border border-gray-300 p-2 rounded-lg w-full mb-3",type:"search",placeholder:"search...",name:"",id:""},null,512),[[W,n(v)]])]),o("div",re,[o("table",ie,[o("thead",ue,[o("tr",null,[(i(),r(f,null,b(E,(s,a)=>o("th",{key:a,class:"px-4 py-2 border text-[11px] border-gray-300 text-left whitespace-nowrap"},m(s),1)),64))])]),o("tbody",null,[(i(!0),r(f,null,b(n(g),(s,a)=>(i(),r("tr",{key:a,class:"hover:bg-blue-100 cursor-pointer",onClick:u=>G(s)},[(i(),r(f,null,b(E,(u,c)=>o("td",{key:c,class:"px-4 py-3 border-b text-[12px] bg-white border-gray-200 whitespace-nowrap"},m(s[c]),1)),64))],8,ce))),128))])])])]),n(l)?(i(),r("div",{key:0,onClick:ee(C,["self"]),class:"fixed p-10 w-full inset-0 bg-black/50 bg-opacity-50 flex items-center justify-center"},[o("div",de,[o("div",me,[o("div",pe,[o("h2",fe,[e[1]||(e[1]=A("Staff : ")),o("span",be,m(n(l).name),1)]),o("h2",ge,[e[2]||(e[2]=A("Supervisor : ")),o("span",ve,m(n(l).supervisor),1)]),o("h2",he,[e[3]||(e[3]=A("Year : ")),o("span",ye,m(new Date().getFullYear()),1)])]),o("button",{onClick:C,class:"p-2 absolute top-0 right-2 text-2xl cursor-pointer"},e[4]||(e[4]=[o("i",{class:"uil uil-times"},null,-1)])),n(l).timeAllocations.length>0?(i(),r("button",{key:0,onClick:j,class:"p-1 px-2 mb-2 bg-green-500 text-white cursor-pointer rounded hover:bg-green-400"}," + Add new ")):y("",!0),o("div",_e,[o("div",xe,[o("div",Ae,[n(l).monthlyTotal?(i(),r(f,{key:0},b(O,(s,a)=>o("div",we,[o("span",Te,m(F(s,a)),1),D(M,{name:"fade-slide",mode:"out-in"},{default:L(()=>[(i(),r("span",{class:w([Z(n(l).monthlyTotal[a],a)," px-1 font-medium"]),key:n(l).monthlyTotal[a]},m(P(n(l).monthlyTotal[a],a)),3))]),_:2},1024)])),64)):y("",!0)])])])]),n(l).timeAllocations.length>0?(i(),r("div",Ne,[(i(!0),r(f,null,b(n(l).timeAllocations,(s,a)=>{var u,c,_,x;return i(),r("div",{class:"w-full",key:a},[o("div",Ce,[o("div",{class:w(["flex w-full  items-start p-2 rounded-md  cursor-pointer  mb-2 hover:bg-blue-50",(c=(u=n(l).timeAllocations)==null?void 0:u[a])!=null&&c.id?"bg-gray-100 ":"bg-red-50"])},[(i(),r(f,null,b(O,(R,d)=>o("div",Ie,[o("label",Ee,m(R),1),o("div",Oe,[o("div",{class:"absolute inset-0 bg-green-300 transition-all duration-200 rounded",style:te({width:q(d,n(l).timeAllocations[a][d]),zIndex:0})},null,4),S(o("input",{type:d=="agreement"||d=="bus"?"text":"number",min:"0",max:"100",disabled:d=="total",class:w([[{"bg-yellow-400":d=="total"}],"relative z-10 w-full h-full border text-center text-sm border-gray-300 focus:outline-none focus:ring-2 focus:rounded-md focus:ring-green-500 focus:border-green-500"]),onInput:I=>B(I.target.value,a),"onUpdate:modelValue":I=>n(l).timeAllocations[a][d]=I},null,42,je),[[oe,n(l).timeAllocations[a][d]]])]),D(M,{name:"fade-slide",mode:"out-in"},{default:L(()=>[N.includes(d)?y("",!0):(i(),r("span",{key:n(l).timeAllocations[a][d],class:"text-[11px] font-bold block"},m(n(l).timeAllocations[a][d])+"% ",1))]),_:2},1024)])),64))],2),(x=(_=n(l).timeAllocations)==null?void 0:_[a])!=null&&x.id?y("",!0):(i(),r("button",{key:0,onClick:R=>J(a),type:"button",class:"p-1 cursor-pointer"},"x",8,ke))])])}),128))])):(i(),r("div",Re,[e[5]||(e[5]=o("span",null,"No Data",-1)),o("button",{onClick:j,class:"p-1 px-2 mb-2 max-w-max border border-green-500 text-green-500 cursor-pointer rounded"}," + Add new ")])),o("div",Se,[o("div",De,[o("button",{class:"px-3 p-1 cursor-pointer bg-gray-100 border border-gray-300 rounded hover:bg-gray-400",onClick:C}," cancel "),o("button",{class:"px-3 py-1 cursor-pointer border-0 bg-blue-600 text-white rounded hover:bg-blue-700",onClick:Y},[n(T)?(i(),r("div",Le,e[6]||(e[6]=[o("div",{class:"w-5 h-5 border-5 border-white border-t-transparent rounded-full animate-spin"},null,-1),A(" Processing...")]))):(i(),r("span",Me," Save now"))])])])])])):y("",!0)]))}},$e=le(Ve,[["__scopeId","data-v-807a6326"]]);export{$e as default};
