import{d as U,r as g,w as G,e as d,l as _,o as i,f as l,F as x,k as b,t as p,j as T,g as w,m as J,n as Y,T as K,c as O,p as q}from"./app-GUirp5UT.js";import{_ as H}from"./ItemTimeAllocationComponent.vue_vue_type_script_setup_true_lang-DQGZd4Mr.js";import{_ as Q}from"./ButtonSaveComponent.vue_vue_type_script_setup_true_lang-D1KTyqzm.js";import{_ as W}from"./ButtonEmailComponent.vue_vue_type_script_setup_true_lang-LrS9sI7c.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Z={class:"bg-white flex flex-col w-[100%] p-3 px-5 rounded-xl shadow-xl overflow-hidden max-h-[90vh]"},ee={key:0,class:"w-full py-10 text-center text-lg font-bold"},te={class:"w-full relative"},ae={class:"w-full flex items-center gap-2 text-[14px] py-3"},se={class:"font-semibold mb-4 uppercase"},le={class:"capitalize text-gray-600"},oe={class:"font-semibold mb-4 uppercase"},ne={class:"capitalize text-gray-600"},ie={class:"font-semibold mb-4 uppercase"},ce={class:"capitalize text-gray-600"},de={key:1,class:"w-full flex items-center gap-2"},ue={class:"borders flex gap-2 borders-gray-200 w-full"},re={class:"flex w-full items-start p-2 rounded-md cursor-pointer"},me={class:"font-bold"},fe={key:0,class:"flex-1 overflow-y-auto"},pe={key:1,class:"text-center flex flex-col items-center gap-2 mt-2 font-medium"},ge={class:"w-full"},ve={class:"mt-3 flex justify-end gap-2"},he=U({__name:"AllocationConmponent",props:{selectedRow:{},staffId:{}},emits:["update:selectedRow","close","save","delete","sendEmail"],setup(j,{emit:E}){const R=j,N=E,v=g(!1),S=g(null),o=g([]),r=g(null),k={agreement:"AGREEMENT",bus:"BUS",jan:"JAN",feb:"FEB",mar:"MAR",apr:"APR",may:"MAY",jun:"JUN",jul:"JUL",aug:"AUG",sep:"SEP",oct:"OCT",nov:"NOV",dec:"DEC",total:"Total"},D=["id","agreement","bus"],M=()=>({id:null,agreement:"",bus:"",jan:0,feb:0,mar:0,apr:0,may:0,jun:0,jul:0,aug:0,sep:0,oct:0,nov:0,dec:0,total:0}),B=()=>({id:null,jan:0,feb:0,mar:0,apr:0,may:0,jun:0,jul:0,aug:0,sep:0,oct:0,nov:0,dec:0,total:0}),h=async a=>{a&&(v.value=!0,window.axios.get("/staff/time-allocations/"+a).then(e=>{const{time_allocations:t,...s}=e.data.data;o.value=t,r.value=s}).catch(e=>{var t,s,n;alert(((s=(t=e.response)==null?void 0:t.data)==null?void 0:s.message)||e.message),console.error("Error saving allocations:",((n=e.response)==null?void 0:n.data)||e.message)}).finally(()=>{v.value=!1}))};G(()=>R.staffId,async a=>{a&&h(a)},{immediate:!0});const y=()=>{N("close"),o.value=null},A=()=>{o.value&&(o.value.unshift(M()),o.value.length===1&&(o.value.monthlyTotal=B()))},P=a=>{o.value&&o.value.splice(a,1)};function $(a){if(o.value.length===0)return alert("Please add a time allocation before submitting."),a(!0),!1;if(!confirm("Are you sure you want to save these changes?"))return a(!0),!1;let e={...o.value};window.axios.post("/time-allocations",{employeeId:r.value.employeeId,timeAllocations:e,monthlyTimeTotal:e.monthlyTotal}).then(async t=>{var s;await h(r.value.employeeId),alert(((s=t==null?void 0:t.data)==null?void 0:s.message)||(t==null?void 0:t.message))}).catch(t=>{var s,n,u;alert(((n=(s=t.response)==null?void 0:s.data)==null?void 0:n.message)||t.message),console.error("Error saving allocations:",((u=t.response)==null?void 0:u.data)||t.message)}).finally(()=>{a(!0)})}function z(a,e,t){if(!confirm("Are you sure you want to delete these changes?")){t(!0);return}S.value=a,axios.post("/time-delete",{employeeId:r.value.employeeId,id:a}).then(async s=>{await h(r.value.employeeId),alert("Allocations delete successfully")}).catch(s=>{var n,u,m;alert(((u=(n=s.response)==null?void 0:n.data)==null?void 0:u.message)||s.message),console.error("Error saving allocations:",((m=s.response)==null?void 0:m.data)||s.message)}).finally(()=>{t(!0)})}function F(a){if(o.value.length===0)return alert("Please add a time allocation before submitting."),a(!0),!1;if(!confirm("Do you really want to send this email?")){a(!0);return}axios.post("/send-mail",{employeeId:r.value.employeeId}).then(e=>{var t;alert(((t=e==null?void 0:e.data)==null?void 0:t.message)||(e==null?void 0:e.message))}).catch(e=>{var t;alert(((t=e==null?void 0:e.response.data)==null?void 0:t.message)||(e==null?void 0:e.message))}).finally(()=>{a(!0)})}const C=(a,e)=>D.includes(e)?"":a.reduce((t,s)=>{const n=Number(s[e])||0;return t+n},0),V=(a,e)=>["agreement","bus"].includes(e)?"":`${a}:`,L=(a,e)=>{const t=e==="total"?1200:100;return a<t?"bg-blue-500":a>t?"bg-red-500":"bg-green-300"};return(a,e)=>{var t,s,n,u,m;return a.staffId?(i(),d("div",{key:0,onClick:q(y,["self"]),class:"fixed p-10 w-full z-40 inset-0 bg-black/50 bg-opacity-50 flex items-center justify-center"},[l("div",Z,[v.value?(i(),d("div",ee," Loading... ")):(i(),d(x,{key:1},[l("div",te,[l("div",ae,[l("h2",se,[e[0]||(e[0]=b(" Staff: ")),l("span",le,p(((t=a.selectedRow)==null?void 0:t.name)+" "+((s=a.selectedRow)==null?void 0:s.lastName)),1)]),l("h2",oe,[e[1]||(e[1]=b(" Supervisor: ")),l("span",ne,p((n=a.selectedRow)==null?void 0:n.supervisor_name),1)]),l("h2",ie,[e[2]||(e[2]=b(" Year: ")),l("span",ce,p(new Date().getFullYear()),1)])]),l("button",{type:"button",onClick:y,class:"p-2 absolute top-0 right-2 text-2xl cursor-pointer"},e[3]||(e[3]=[l("i",{class:"uil uil-times"},null,-1)])),((u=o.value)==null?void 0:u.length)>0?(i(),d("button",{key:0,onClick:A,class:"p-1 px-2 mb-2 bg-green-500 text-white cursor-pointer rounded hover:bg-green-400"}," + Add new ")):_("",!0),o.value?(i(),d("div",de,[l("div",ue,[l("div",re,[(i(),d(x,null,T(k,(f,c)=>l("div",{class:"w-full flex items-center justify-center gap-1 text-[11px]",key:c},[l("span",me,p(V(f,c)),1),w(K,{name:"fade-slide",mode:"out-in"},{default:J(()=>[(i(),d("span",{class:Y([L(C(o.value,c),c),"px-1 font-medium"]),key:`${c}`},p(C(o.value,c)),3))]),_:2},1024)])),64))])])])):_("",!0)]),((m=o.value)==null?void 0:m.length)>0?(i(),d("div",fe,[(i(!0),d(x,null,T(o.value,(f,c)=>(i(),O(H,{key:f.id||c,allocation:f,onRemoveItem:I=>P(c),onDelete:I=>z(f.id,c,I)},null,8,["allocation","onRemoveItem","onDelete"]))),128))])):(i(),d("div",pe,[e[4]||(e[4]=l("span",null,"No Data",-1)),l("button",{onClick:A,class:"p-1 px-2 mb-2 max-w-max border border-green-500 text-green-500 cursor-pointer rounded"}," + Add new ")])),l("div",ge,[l("div",ve,[l("button",{class:"px-3 p-1 cursor-pointer bg-gray-100 border border-gray-300 rounded hover:bg-gray-400",onClick:y}," Cancel "),w(Q,{onSave:$}),w(W,{onSave:F})])])],64))])])):_("",!0)}}}),Ae=X(he,[["__scopeId","data-v-d19eed83"]]);export{Ae as default};
