import{r as K,a as A,b as Q,w as W,e as X,f as r,o as i,g as o,h as y,i as R,v as ee,u as n,j as te,F as b,k as g,t as m,l as oe,m as _,n as T,p as D,q as M,T as L,s as le,x as ae}from"./app-D7e5-xxM.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";K();const ne={class:"p-7 w-full h-screen flex flex-col"},re={class:"flex-1"},ie={class:"w-full"},de={class:"overflow-x-auto border border-gray-200 rounded-lg overflow-y-auto min-h-10 max-h-[600px]"},ce={class:"min-w-max text-sm w-full border-collapse"},ue={class:"bg-gray-200 sticky top-0"},me=["onClick"],pe={class:"bg-white flex flex-col w-[100%] p-3 px-5 rounded-xl shadow-xl overflow-hidden max-h-[90vh]"},fe={class:"w-full relative"},be={class:"w-full flex items-center gap-2 text-[14px] py-3"},ge={class:"font-semibold mb-4 uppercase"},ve={class:"capitalize text-gray-600"},he={class:"font-semibold mb-4 uppercase"},ye={class:"capitalize text-gray-600"},_e={class:"font-semibold mb-4 uppercase"},xe={class:"capitalize text-gray-600"},we={class:"w-full flex items-center gap-2"},Ae={class:"borders flex gap-2 borders-gray-200 w-full"},Te={class:T(["flex w-full  items-start p-2 rounded-md  cursor-pointer "])},Ne={class:"w-full flex items-center justify-center gap-1 text-[11px]"},Ie={class:"font-bold"},Ce={key:0,class:"flex-1 overflow-y-auto"},ke={class:"borders flex gap-2 borders-gray-200 w-full"},Ee={class:"w-full text-center"},Oe={class:"block mb-2 text-[12px] font-medium lowercase text-gray-700"},Se={class:"relative w-full h-8"},je=["type","disabled","onInput","onUpdate:modelValue"],Re=["onClick"],De={key:1,class:"text-center flex flex-col items-center gap-2 mt-2 font-medium"},Me={class:"w-full"},Le={class:"mt-3 flex justify-end gap-2"},Ve={key:0,class:"flex items-center gap-1"},ze={key:1},Ue={key:0,class:"flex items-center gap-1"},Pe={key:1},$e={__name:"TableOne",props:{staff:Array},setup(V){const z=V;let v=A([]);const p=A([]);let f=Q({send:!1,save:!1}),h=A("");const N=["id","employeeId","agreement","bus","year","date","total"];Array.prototype.isAnyExcluded=function(t){return t.some(e=>this.includes(e))};const k={resno:"RESNO",name:"NAME",position:"POSITION",grade_level:"GRADE/LEVEL",grade:"GRADE",organization:"ORGANIZATION",country:"COUNTRY",base_station:"BASE STATION",division:"DIVISION",unit_program:"UNIT/PROGRAM",supervisor:"SUPERVISOR"},E={agreement:"AGREEMENT",bus:"BUS",jan:"JAN",feb:"FEB",apr:"APR",mar:"MAR",may:"MAY",jun:"JUN",jul:"JUL",aug:"AUG",sep:"SEP",oct:"OCT",nov:"NOV",dec:"DEC",total:"TOTAL"},U={id:null,agreement:0,bus:0,jan:0,feb:0,mar:0,apr:0,may:0,jun:0,jul:0,aug:0,sep:0,oct:0,nov:0,dec:0,total:0},P={id:null,jan:0,feb:0,mar:0,apr:0,may:0,jun:0,jul:0,aug:0,sep:0,oct:0,nov:0,dec:0,total:0};let l=A(null);const $=(t,e)=>{const a=Object.keys(l.value.timeAllocations[e]).filter(s=>{if(!N.includes(s))return s}).reduce((s,d)=>(l.value.timeAllocations[e][d]&&(s+=l.value.timeAllocations[e][d]),s),0);l.value.timeAllocations[e].total=a,l.value.monthlyTotal={...l.value.monthlyTotal,...S(l.value.timeAllocations)},console.log(l.value.timeAllocations[e])};function B(t){l.value={...t,timeAllocations:[...t.timeAllocations]}}function I(){l.value=null}const G=(t,e)=>{let a=["agreement","bus"];return console.log(e),a.includes(e)?"":`${t}%`},F=(t,e)=>["agreement","bus"].includes(e)?"":`${t}:`;function O(){l.value.timeAllocations.unshift({...U}),l.value.timeAllocations.length==1&&(l.value.monthlyTotal={...P})}function S(t){const e=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],a={};let s=0;for(const d of e){const c=t.reduce((x,w)=>x+(Number(w[d])||0),0);a[`${d}`]=c,s+=c}return a.total=s,a}function Y(t){if(!confirm("Are you sure you want to save these changes?"))return;let e={...l.value};f.save=!0,axios.post("/time-allocations",{employeeId:e.employeeId,timeAllocations:e.timeAllocations,monthlyTimeTotal:e.monthlyTotal}).then(a=>{alert("Allocations saved successfully"),console.log("Allocations saved successfully",a.data.data.time_allocations);let s=v.value.findIndex(c=>c.employeeId==e.employeeId),d=p.value.findIndex(c=>c.employeeId==e.employeeId);p.value[d]={...e,timeAllocations:[...a.data.data.time_allocations],monthlyTotal:{...a.data.data.monthly_total}},v.value[s]={...p.value[d]},l.value.timeAllocations=[...a.data.data.time_allocations],l.value.monthlyTotal={...a.data.data.monthly_total}}).catch(a=>{var s;alert("Error saving allocations"),console.error("Error saving allocations:",((s=a.response)==null?void 0:s.data)||a.message)}).finally(()=>{f.save=!1})}function J(t){if(!confirm("Do you really want to deny this email?"))return;f.send=!0;let e={...l.value};axios.post("/send-mail",{employeeId:e.employeeId}).then(a=>{alert("Allocations send successfully")}).catch(a=>{alert("Error send allocations")}).finally(()=>{f.send=!1})}function q(t){l.value.timeAllocations.splice(t,1),l.value.monthlyTotal=S(l.value.timeAllocations),l.value.timeAllocations.length==0&&(l.value.monthlyTotal=null)}function Z(t,e){return N.includes(t)?0:e?`${e>100?100:e}%`:0}function H(t,e){let a=e=="total"?1200:100;return t<a?"bg-blue-500":t>a?"bg-red-500":"bg-green-300"}return W(h,t=>{const e=t.toLowerCase();v.value=p.value.filter(a=>a.name.toLowerCase().includes(e)||a.resno.toLowerCase().includes(e))}),X(()=>{p.value=z.staff.map(t=>{var e;return{employeeId:t.employeeId,resno:t.resno||"N/A",name:((e=t==null?void 0:t.lastName)==null?void 0:e.toLowerCase())+" "+(t==null?void 0:t.name.toLowerCase()),position:t.position||"N/A",grade_level:t.grade_level||"N/A",grade:t.grade||"N/A",organization:t.organization||"N/A",country:t.country||"N/A",base_station:t.base_station||"N/A",division:t.division||"N/A",unit_program:t.unit_program||"N/A",supervisor:t.supervisor&&`${t.supervisor.firstName.toLowerCase()||""} ${t.supervisor.lastName.toLowerCase()||""}`.trim()||"N/A",timeAllocations:t.time_allocations,monthlyTotal:t.monthly_total}}),v.value=[...p.value]}),(t,e)=>(i(),r("div",ne,[e[8]||(e[8]=o("h1",{class:"text-xl font-bold mb-4"},"Staff Time Allocation",-1)),o("div",re,[o("div",ie,[R(o("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>te(h)?h.value=a:h=a),class:"border border-gray-300 p-2 rounded-lg w-full mb-3",type:"search",placeholder:"search...",name:"",id:""},null,512),[[ee,n(h)]])]),o("div",de,[o("table",ce,[o("thead",ue,[o("tr",null,[(i(),r(b,null,g(k,(a,s)=>o("th",{key:s,class:"px-4 py-2 border text-[11px] border-gray-300 text-left whitespace-nowrap"},m(a),1)),64))])]),o("tbody",null,[(i(!0),r(b,null,g(n(v),(a,s)=>(i(),r("tr",{key:s,class:"hover:bg-blue-100 cursor-pointer",onClick:d=>B(a)},[(i(),r(b,null,g(k,(d,c)=>o("td",{key:c,class:"px-4 py-3 border-b text-[12px] bg-white border-gray-200 whitespace-nowrap"},m(a[c]),1)),64))],8,me))),128))])])])]),n(l)?(i(),r("div",{key:0,onClick:oe(I,["self"]),class:"fixed p-10 w-full inset-0 bg-black/50 bg-opacity-50 flex items-center justify-center"},[o("div",pe,[o("div",fe,[o("div",be,[o("h2",ge,[e[1]||(e[1]=_("Staff : ")),o("span",ve,m(n(l).name),1)]),o("h2",he,[e[2]||(e[2]=_("Supervisor : ")),o("span",ye,m(n(l).supervisor),1)]),o("h2",_e,[e[3]||(e[3]=_("Year : ")),o("span",xe,m(new Date().getFullYear()),1)])]),o("button",{onClick:I,class:"p-2 absolute top-0 right-2 text-2xl cursor-pointer"},e[4]||(e[4]=[o("i",{class:"uil uil-times"},null,-1)])),n(l).timeAllocations.length>0?(i(),r("button",{key:0,onClick:O,class:"p-1 px-2 mb-2 bg-green-500 text-white cursor-pointer rounded hover:bg-green-400"}," + Add new ")):y("",!0),o("div",we,[o("div",Ae,[o("div",Te,[n(l).monthlyTotal?(i(),r(b,{key:0},g(E,(a,s)=>o("div",Ne,[o("span",Ie,m(F(a,s)),1),D(L,{name:"fade-slide",mode:"out-in"},{default:M(()=>[(i(),r("span",{class:T([H(n(l).monthlyTotal[s],s)," px-1 font-medium"]),key:n(l).monthlyTotal[s]},m(G(n(l).monthlyTotal[s],s)),3))]),_:2},1024)])),64)):y("",!0)])])])]),n(l).timeAllocations.length>0?(i(),r("div",Ce,[(i(!0),r(b,null,g(n(l).timeAllocations,(a,s)=>{var d,c,x,w;return i(),r("div",{class:"w-full",key:s},[o("div",ke,[o("div",{class:T(["flex w-full  items-start p-2 rounded-md  cursor-pointer  mb-2 hover:bg-blue-50",(c=(d=n(l).timeAllocations)==null?void 0:d[s])!=null&&c.id?"bg-gray-100 ":"bg-red-50"])},[(i(),r(b,null,g(E,(j,u)=>o("div",Ee,[o("label",Oe,m(j),1),o("div",Se,[o("div",{class:"absolute inset-0 bg-green-300 transition-all duration-200 rounded",style:le({width:Z(u,n(l).timeAllocations[s][u]),zIndex:0})},null,4),R(o("input",{type:u=="agreement"||u=="bus"?"text":"number",min:"0",max:"100",disabled:u=="total",class:T([[{"bg-yellow-400":u=="total"}],"relative z-10 w-full h-full border text-center text-sm border-gray-300 focus:outline-none focus:ring-2 focus:rounded-md focus:ring-green-500 focus:border-green-500"]),onInput:C=>$(C.target.value,s),"onUpdate:modelValue":C=>n(l).timeAllocations[s][u]=C},null,42,je),[[ae,n(l).timeAllocations[s][u]]])]),D(L,{name:"fade-slide",mode:"out-in"},{default:M(()=>[N.includes(u)?y("",!0):(i(),r("span",{key:n(l).timeAllocations[s][u],class:"text-[11px] font-bold block"},m(n(l).timeAllocations[s][u])+"% ",1))]),_:2},1024)])),64))],2),(w=(x=n(l).timeAllocations)==null?void 0:x[s])!=null&&w.id?y("",!0):(i(),r("button",{key:0,onClick:j=>q(s),type:"button",class:"p-1 cursor-pointer"},"x",8,Re))])])}),128))])):(i(),r("div",De,[e[5]||(e[5]=o("span",null,"No Data",-1)),o("button",{onClick:O,class:"p-1 px-2 mb-2 max-w-max border border-green-500 text-green-500 cursor-pointer rounded"}," + Add new ")])),o("div",Me,[o("div",Le,[o("button",{class:"px-3 p-1 cursor-pointer bg-gray-100 border border-gray-300 rounded hover:bg-gray-400",onClick:I}," cancel "),o("button",{class:"px-3 py-1 cursor-pointer border-0 bg-green-500 text-white rounded hover:bg-green-700",onClick:Y},[n(f).save?(i(),r("div",Ve,e[6]||(e[6]=[o("div",{class:"w-5 h-5 border-5 border-white border-t-transparent rounded-full animate-spin"},null,-1),_(" Processing...")]))):(i(),r("span",ze," Save now"))]),o("button",{class:"px-3 py-1 cursor-pointer border-0 bg-blue-600 text-white rounded hover:bg-blue-700",onClick:J},[n(f).send?(i(),r("div",Ue,e[7]||(e[7]=[o("div",{class:"w-5 h-5 border-5 border-white border-t-transparent rounded-full animate-spin"},null,-1),_(" Processing...")]))):(i(),r("span",Pe," Send now"))])])])])])):y("",!0)]))}},Fe=se($e,[["__scopeId","data-v-0ebbf030"]]);export{Fe as default};
