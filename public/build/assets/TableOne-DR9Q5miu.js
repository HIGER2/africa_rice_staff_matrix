import{r as F,a as g,w as Y,b as q,e as n,o as r,f as t,g as y,h as T,v as Z,u as i,i as H,F as m,j as p,t as d,k as O,l as S,T as k,n as w,m as K,p as Q}from"./app-U-1CFKYv.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";F();const X={class:"p-7 w-full h-screen flex flex-col"},ee={class:"flex-1"},te={class:"w-full"},oe={class:"overflow-x-auto border border-gray-200 rounded-lg overflow-y-auto min-h-10 max-h-[600px]"},le={class:"min-w-max text-sm w-full border-collapse"},se={class:"bg-gray-200 sticky top-0"},ae=["onClick"],ne={key:0,class:"fixed p-10 w-full inset-0 bg-black/50 bg-opacity-50 flex items-center justify-center"},re={class:"bg-white flex flex-col w-[100%] p-3 px-5 rounded-xl shadow-xl overflow-hidden max-h-[90vh]"},ie={class:"w-full"},ce={class:"text-lg font-semibold mb-4"},ue={class:"w-full flex items-center gap-3"},de={class:"text-green-500"},me={key:0,class:"flex-1 overflow-y-auto"},pe={class:w([" borders flex gap-2 borders-gray-200  w-full"])},fe={class:"w-full text-center"},be={class:"block mb-2 text-[12px] font-medium lowercase text-gray-700"},ge={class:"relative w-full h-8"},ve=["type","disabled","onInput","onUpdate:modelValue"],_e=["onClick"],Ae={key:1,class:"text-center mt-2 font-medium"},he={class:"w-full"},xe={class:"mt-3 flex justify-end gap-2"},ye={key:0},we={key:1},Ne={__name:"TableOne",props:{staff:Array},setup(j){const U=j;let _=g([]);const A=g([]);let v=g(!1),f=g("");const h=["id","employeeId","agreement","bus","year","date","total"],N={resno:"RESNO",name:"NAME",position:"POSITION",grade_level:"GRADE/LEVEL",grade:"GRADE",organization:"ORGANIZATION",country:"COUNTRY",base_station:"BASE STATION",division:"DIVISION",unit_program:"UNIT/PROGRAM",supervisor:"SUPERVISOR"},D={jan:"JAN",feb:"FEB",apr:"APR",mar:"MAR",may:"MAY",jun:"JUN",jul:"JUL",aug:"AUG",sep:"SEP",oct:"OCT",nov:"NOV",dec:"DEC"},L={agreement:"AGREEMENT",bus:"BUS",jan:"JAN",feb:"FEB",apr:"APR",mar:"MAR",may:"MAY",jun:"JUN",jul:"JUL",aug:"AUG",sep:"SEP",oct:"OCT",nov:"NOV",dec:"DEC",total:"Total"},M={id:null,agreement:0,bus:0,jan:0,feb:0,apr:0,mar:0,may:0,jun:0,jul:0,aug:0,sep:0,oct:0,nov:0,dec:0,total:0};let l=g(null);const V=(e,s)=>{const a=Object.keys(l.value.timeAllocations[s]).filter(o=>{if(!h.includes(o))return o}).reduce((o,u)=>(l.value.timeAllocations[s][u]&&(o+=l.value.timeAllocations[s][u]),o),0);l.value.timeAllocations[s].total=a,console.log(l.value.timeAllocations[s])};function P(e){l.value={...e,timeAllocations:[...e.timeAllocations]}}function z(){l.value=null}const C=(e,s)=>`${e.reduce((o,u)=>(u[s]&&(o+=Number(u[s])),o),0)}%`;function B(){console.log(l.value.timeAllocations),l.value.timeAllocations.unshift({...M})}function G(e){if(!confirm("Confirm ?"))return;let s={...l.value};v.value=!0,axios.post("/time-allocations",{employeeId:s.employeeId,timeAllocations:s.timeAllocations}).then(a=>{alert("Allocations saved successfully"),console.log("Allocations saved successfully",a.data.data.time_allocations),l.value.timeAllocations=[...a.data.data.time_allocations],v.value=!1}).catch(a=>{var o;alert("Error saving allocations"),console.error("Error saving allocations:",((o=a.response)==null?void 0:o.data)||a.message),v.value=!1})}function J(e){l.value.timeAllocations.splice(e,1)}function $(e,s){return h.includes(e)?0:s?`${s>100?100:s}%`:0}return Y(f,e=>{const s=e.toLowerCase();_.value=A.value.filter(a=>a.name.toLowerCase().includes(s)||a.resno.toLowerCase().includes(s))}),q(()=>{A.value=U.staff.map(e=>({employeeId:e.employeeId,resno:e.resno||"N/A",name:e.name+" "+e.lastName,position:e.position||"N/A",grade_level:e.grade_level||"N/A",grade:e.grade||"N/A",organization:e.organization||"N/A",country:e.country||"N/A",base_station:e.base_station||"N/A",division:e.division||"N/A",unit_program:e.unit_program||"N/A",supervisor:e.supervisor&&`${e.supervisor.firstName||""} ${e.supervisor.lastName||""}`.trim()||"N/A",timeAllocations:e.time_allocations})),_.value=[...A.value]}),(e,s)=>(r(),n("div",X,[s[2]||(s[2]=t("h1",{class:"text-xl font-bold mb-4"},"Staff Time Allocation",-1)),t("div",ee,[t("div",te,[T(t("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>H(f)?f.value=a:f=a),class:"border border-gray-300 p-2 rounded-lg w-full mb-3",type:"text",placeholder:"search...",name:"",id:""},null,512),[[Z,i(f)]])]),t("div",oe,[t("table",le,[t("thead",se,[t("tr",null,[(r(),n(m,null,p(N,(a,o)=>t("th",{key:o,class:"px-4 py-2 border text-[11px] border-gray-300 text-left whitespace-nowrap"},d(a),1)),64))])]),t("tbody",null,[(r(!0),n(m,null,p(i(_),(a,o)=>(r(),n("tr",{key:o,class:"hover:bg-blue-100 cursor-pointer",onClick:u=>P(a)},[(r(),n(m,null,p(N,(u,b)=>t("td",{key:b,class:"px-4 py-3 border-b text-[12px] bg-white border-gray-200 whitespace-nowrap"},d(a[b]),1)),64))],8,ae))),128))])])])]),i(l)?(r(),n("div",ne,[t("div",re,[t("div",ie,[t("h2",ce,"Staff Time Allocation : "+d(i(l).name),1),t("button",{onClick:B,class:"p-1 px-2 mb-2 bg-green-500 text-white cursor-pointer rounded hover:bg-green-400"}," + Add new "),t("div",ue,[(r(),n(m,null,p(D,(a,o)=>t("div",{key:o,class:"flex items-center gap-1 py-3 font-medium text-[12px]"},[t("span",de,d(a)+" :",1),O(k,{name:"fade-slide",mode:"out-in"},{default:S(()=>[(r(),n("span",{key:C(i(l).timeAllocations,a.toLocaleLowerCase())},d(C(i(l).timeAllocations,a.toLocaleLowerCase())),1))]),_:2},1024)])),64))])]),i(l).timeAllocations.length>0?(r(),n("div",me,[(r(!0),n(m,null,p(i(l).timeAllocations,(a,o)=>{var u,b,E,I;return r(),n("div",{class:"w-full",key:o},[t("div",pe,[t("div",{class:w(["flex w-full  items-start p-2 rounded-md  cursor-pointer  mb-2 hover:bg-blue-50",(b=(u=i(l).timeAllocations)==null?void 0:u[o])!=null&&b.id?"bg-gray-100 ":"bg-red-50"])},[(r(),n(m,null,p(L,(R,c)=>t("div",fe,[t("label",be,d(R),1),t("div",ge,[t("div",{class:"absolute inset-0 bg-green-300 transition-all duration-200 rounded",style:K({width:$(c,i(l).timeAllocations[o][c]),zIndex:0})},null,4),T(t("input",{type:c=="agreement"||c=="bus"?"text":"number",min:"0",max:"100",disabled:c=="total",class:w([[{"bg-yellow-400":c=="total"}],"relative z-10 w-full h-full border text-center text-sm border-gray-300 focus:outline-none focus:ring-2 focus:rounded-md focus:ring-green-500 focus:border-green-500"]),onInput:x=>V(x.target.value,o),"onUpdate:modelValue":x=>i(l).timeAllocations[o][c]=x},null,42,ve),[[Q,i(l).timeAllocations[o][c]]])]),O(k,{name:"fade-slide",mode:"out-in"},{default:S(()=>[h.includes(c)?y("",!0):(r(),n("span",{key:i(l).timeAllocations[o][c],class:"text-[11px] font-bold block"},d(i(l).timeAllocations[o][c])+"% ",1))]),_:2},1024)])),64))],2),(I=(E=i(l).timeAllocations)==null?void 0:E[o])!=null&&I.id?y("",!0):(r(),n("button",{key:0,onClick:R=>J(o),type:"button",class:"p-1 cursor-pointer"},"x",8,_e))])])}),128))])):(r(),n("div",Ae,s[1]||(s[1]=[t("span",null,"No Data",-1)]))),t("div",he,[t("div",xe,[t("button",{class:"px-3 p-1 cursor-pointer bg-gray-100 border border-gray-300 rounded hover:bg-gray-400",onClick:z}," cancel "),t("button",{class:"px-3 py-1 cursor-pointer border-0 bg-blue-600 text-white rounded hover:bg-blue-700",onClick:G},[i(v)?(r(),n("div",ye,"Processing...")):(r(),n("span",we," Save now"))])])])])])):y("",!0)]))}},Ie=W(Ne,[["__scopeId","data-v-307c6f74"]]);export{Ie as default};
