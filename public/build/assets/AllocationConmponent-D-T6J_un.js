import{d as Y,r as p,w as K,e as u,l as y,o as r,f as l,F as _,k as b,t as f,j as C,g as x,m as O,n as q,T as H,c as Q,p as W}from"./app-BWPZoc_W.js";import{_ as X}from"./ItemTimeAllocationComponent.vue_vue_type_script_setup_true_lang-aDbpmdLx.js";import{_ as Z}from"./ButtonSaveComponent.vue_vue_type_script_setup_true_lang-DJ7T28WK.js";import{_ as ee}from"./ButtonEmailComponent.vue_vue_type_script_setup_true_lang-QXrsGeyP.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ae={class:"bg-white flex flex-col w-[100%] p-3 px-5 rounded-xl shadow-xl overflow-hidden max-h-[90vh]"},se={key:0,class:"w-full py-10 text-center text-lg font-bold"},le={class:"w-full relative"},oe={class:"w-full flex items-center gap-2 text-[14px] py-3"},ne={class:"font-semibold mb-4 uppercase"},re={class:"capitalize text-gray-600"},ie={class:"font-semibold mb-4 uppercase"},ue={class:"capitalize text-gray-600"},ce={class:"font-semibold mb-4 uppercase"},de={class:"capitalize text-gray-600"},me={key:1,class:"w-full flex items-center gap-2"},fe={class:"borders flex gap-2 borders-gray-200 w-full"},pe={class:"flex w-full items-start p-2 rounded-md cursor-pointer"},ge={class:"font-bold"},ve={key:0,class:"flex-1 overflow-y-auto"},he={key:1,class:"text-center flex flex-col items-center gap-2 mt-2 font-medium"},ye={class:"w-full"},_e={class:"mt-3 flex justify-end gap-2"},be=Y({__name:"AllocationConmponent",props:{selectedRow:{},staffId:{}},emits:["update:selectedRow","close","save","delete","sendEmail"],setup(I,{emit:j}){const E=I,R=j,g=p(!1),N=p(null),o=p([]),d=p(null),S={agreement:"AGREEMENT",bus:"BUS",jan:"JAN",feb:"FEB",mar:"MAR",apr:"APR",may:"MAY",jun:"JUN",jul:"JUL",aug:"AUG",sep:"SEP",oct:"OCT",nov:"NOV",dec:"DEC",total:"Total"},k=["id","agreement","bus"],D=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],M=()=>({id:null,agreement:"",bus:"",jan:0,feb:0,mar:0,apr:0,may:0,jun:0,jul:0,aug:0,sep:0,oct:0,nov:0,dec:0,total:0}),P=()=>({id:null,jan:0,feb:0,mar:0,apr:0,may:0,jun:0,jul:0,aug:0,sep:0,oct:0,nov:0,dec:0,total:0}),v=async a=>{a&&(g.value=!0,window.axios.get("/staff/time-allocations/"+a).then(e=>{const{time_allocations:t,...s}=e.data.data;o.value=t,d.value=s}).catch(e=>{var t,s,n;alert(((s=(t=e.response)==null?void 0:t.data)==null?void 0:s.message)||e.message),console.error("Error saving allocations:",((n=e.response)==null?void 0:n.data)||e.message)}).finally(()=>{g.value=!1}))};K(()=>E.staffId,async a=>{a&&v(a)},{immediate:!0});const $=a=>D.reduce((e,t)=>{const s=Number(a[t])||0;return e+s},0),B=a=>a==null?void 0:a.reduce((e,t)=>e+$(t),0),h=()=>{R("close"),o.value=null},w=()=>{o.value&&(o.value.unshift(M()),o.value.length===1&&(o.value.monthlyTotal=P()))},F=a=>{o.value&&o.value.splice(a,1)};function z(a){if(o.value.length===0)return alert("Please add a time allocation before submitting."),a(!0),!1;if(!confirm("Are you sure you want to save these changes?"))return a(!0),!1;let e={...o.value};window.axios.post("/time-allocations",{employeeId:d.value.employeeId,timeAllocations:e,monthlyTimeTotal:e.monthlyTotal}).then(async t=>{var s;await v(d.value.employeeId),alert(((s=t==null?void 0:t.data)==null?void 0:s.message)||(t==null?void 0:t.message))}).catch(t=>{var s,n,c;alert(((n=(s=t.response)==null?void 0:s.data)==null?void 0:n.message)||t.message),console.error("Error saving allocations:",((c=t.response)==null?void 0:c.data)||t.message)}).finally(()=>{a(!0)})}function V(a,e){if(!confirm("Are you sure you want to delete these changes?")){e(!0);return}N.value=a,axios.post("/time-delete",{employeeId:d.value.employeeId,id:a}).then(async t=>{await v(d.value.employeeId),alert("Allocations delete successfully")}).catch(t=>{var s,n,c;alert(((n=(s=t.response)==null?void 0:s.data)==null?void 0:n.message)||t.message),console.error("Error saving allocations:",((c=t.response)==null?void 0:c.data)||t.message)}).finally(()=>{e(!0)})}function L(a){if(o.value.length===0)return alert("Please add a time allocation before submitting."),a(!0),!1;if(B(o.value)!=1200)return alert("⚠️ The total allocations must add up to exactly 1200.Please check your inputs before sending the email."),a(!0),!1;if(!confirm("Do you really want to send this email?")){a(!0);return}axios.post("/send-mail",{employeeId:d.value.employeeId}).then(e=>{var t;alert(((t=e==null?void 0:e.data)==null?void 0:t.message)||(e==null?void 0:e.message))}).catch(e=>{alert("Error send allocations")}).finally(()=>{a(!0)})}const A=(a,e)=>k.includes(e)?"":a.reduce((t,s)=>{const n=Number(s[e])||0;return t+n},0),U=(a,e)=>["agreement","bus"].includes(e)?"":`${a}:`,G=(a,e)=>{const t=e==="total"?1200:100;return a<t?"bg-blue-500":a>t?"bg-red-500":"bg-green-300"};return(a,e)=>{var t,s,n,c,T;return a.staffId?(r(),u("div",{key:0,onClick:W(h,["self"]),class:"fixed p-10 w-full z-40 inset-0 bg-black/50 bg-opacity-50 flex items-center justify-center"},[l("div",ae,[g.value?(r(),u("div",se," Loading... ")):(r(),u(_,{key:1},[l("div",le,[l("div",oe,[l("h2",ne,[e[0]||(e[0]=b(" Staff: ")),l("span",re,f(((t=a.selectedRow)==null?void 0:t.name)+" "+((s=a.selectedRow)==null?void 0:s.lastName)),1)]),l("h2",ie,[e[1]||(e[1]=b(" Supervisor: ")),l("span",ue,f((n=a.selectedRow)==null?void 0:n.supervisor_name),1)]),l("h2",ce,[e[2]||(e[2]=b(" Year: ")),l("span",de,f(new Date().getFullYear()),1)])]),l("button",{type:"button",onClick:h,class:"p-2 absolute top-0 right-2 text-2xl cursor-pointer"},e[3]||(e[3]=[l("i",{class:"uil uil-times"},null,-1)])),((c=o.value)==null?void 0:c.length)>0?(r(),u("button",{key:0,onClick:w,class:"p-1 px-2 mb-2 bg-green-500 text-white cursor-pointer rounded hover:bg-green-400"}," + Add new ")):y("",!0),o.value?(r(),u("div",me,[l("div",fe,[l("div",pe,[(r(),u(_,null,C(S,(m,i)=>l("div",{class:"w-full flex items-center justify-center gap-1 text-[11px]",key:i},[l("span",ge,f(U(m,i)),1),x(H,{name:"fade-slide",mode:"out-in"},{default:O(()=>[(r(),u("span",{class:q([G(A(o.value,i),i),"px-1 font-medium"]),key:`${i}`},f(A(o.value,i)),3))]),_:2},1024)])),64))])])])):y("",!0)]),((T=o.value)==null?void 0:T.length)>0?(r(),u("div",ve,[(r(!0),u(_,null,C(o.value,(m,i)=>(r(),Q(X,{key:m.id||i,allocation:m,onRemoveItem:J=>F(i),onDelete:J=>V(m.id,i)},null,8,["allocation","onRemoveItem","onDelete"]))),128))])):(r(),u("div",he,[e[4]||(e[4]=l("span",null,"No Data",-1)),l("button",{onClick:w,class:"p-1 px-2 mb-2 max-w-max border border-green-500 text-green-500 cursor-pointer rounded"}," + Add new ")])),l("div",ye,[l("div",_e,[l("button",{class:"px-3 p-1 cursor-pointer bg-gray-100 border border-gray-300 rounded hover:bg-gray-400",onClick:h}," Cancel "),x(Z,{onSave:z}),x(ee,{onSave:L})])])],64))])])):y("",!0)}}}),Ie=te(be,[["__scopeId","data-v-43fa21cd"]]);export{Ie as default};
