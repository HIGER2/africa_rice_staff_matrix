import{r as J,a as x,w as q,b as Z,e as n,o as r,f as t,g as y,h as L,v as H,u as i,i as K,F as f,j as m,t as p,k as h,n as N,l as k,m as D,T as V,p as Q,q as W}from"./app-gs0z9HPd.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";J();const ee={class:"p-7 w-full h-screen flex flex-col"},te={class:"flex-1"},oe={class:"w-full"},le={class:"overflow-x-auto border border-gray-200 rounded-lg overflow-y-auto min-h-10 max-h-[600px]"},se={class:"min-w-max text-sm w-full border-collapse"},ae={class:"bg-gray-200 sticky top-0"},ne=["onClick"],re={key:0,class:"fixed p-10 w-full inset-0 bg-black/50 bg-opacity-50 flex items-center justify-center"},ie={class:"bg-white flex flex-col w-[100%] p-3 px-5 rounded-xl shadow-xl overflow-hidden max-h-[90vh]"},ce={class:"w-full relative"},de={class:"w-full flex items-center gap-2 text-[14px] py-3"},ue={class:"font-semibold mb-4 uppercase"},pe={class:"capitalize text-gray-600"},fe={class:"font-semibold mb-4 uppercase"},me={class:"capitalize text-gray-600"},be={class:"font-semibold mb-4 uppercase"},ve={class:"capitalize text-gray-600"},ge={class:"w-full flex items-center gap-2"},_e={class:"borders flex gap-2 borders-gray-200 w-full"},xe={class:N(["flex w-full  items-start p-2 rounded-md  cursor-pointer hover:bg-blue-50"])},he={class:"w-full flex justify-center gap-1 font-bold text-[11px]"},Ae={class:"text-green-500"},we={key:0,class:"flex-1 overflow-y-auto"},ye={class:"borders flex gap-2 borders-gray-200 w-full"},Ne={class:"w-full text-center"},Ie={class:"block mb-2 text-[12px] font-medium lowercase text-gray-700"},Ce={class:"relative w-full h-8"},Te=["type","disabled","onInput","onUpdate:modelValue"],Ee=["onClick"],Oe={key:1,class:"text-center mt-2 font-medium"},Re={class:"w-full"},Se={class:"mt-3 flex justify-end gap-2"},Le={key:0,class:"flex items-center gap-1"},ke={key:1},De={__name:"TableOne",props:{staff:Array},setup(j){const z=j;let b=x([]);const v=x([]);let A=x(!1),g=x("");const _=["id","employeeId","agreement","bus","year","date","total"],I={resno:"RESNO",name:"NAME",position:"POSITION",grade_level:"GRADE/LEVEL",grade:"GRADE",organization:"ORGANIZATION",country:"COUNTRY",base_station:"BASE STATION",division:"DIVISION",unit_program:"UNIT/PROGRAM",supervisor:"SUPERVISOR"},C={agreement:"AGREEMENT",bus:"BUS",jan:"JAN",feb:"FEB",apr:"APR",mar:"MAR",may:"MAY",jun:"JUN",jul:"JUL",aug:"AUG",sep:"SEP",oct:"OCT",nov:"NOV",dec:"DEC",total:"Total"},M={id:null,agreement:0,bus:0,jan:0,feb:0,apr:0,mar:0,may:0,jun:0,jul:0,aug:0,sep:0,oct:0,nov:0,dec:0,total:0};let s=x(null);const U=(o,e)=>{const a=Object.keys(s.value.timeAllocations[e]).filter(l=>{if(!_.includes(l))return l}).reduce((l,c)=>(s.value.timeAllocations[e][c]&&(l+=s.value.timeAllocations[e][c]),l),0);s.value.timeAllocations[e].total=a,console.log(s.value.timeAllocations[e])};function B(o){s.value={...o,timeAllocations:[...o.timeAllocations]}}function T(){s.value=null}const E=(o,e)=>_.includes(e)?"":`${o.reduce((l,c)=>(c[e]&&(l+=Number(c[e])),l),0)}%`,G=(o,e)=>_.includes(e)?"":o;function P(){console.log(s.value.timeAllocations),s.value.timeAllocations.unshift({...M})}function $(o){if(!confirm("Confirm ?"))return;let e={...s.value};A.value=!0,axios.post("/time-allocations",{employeeId:e.employeeId,timeAllocations:e.timeAllocations}).then(a=>{alert("Allocations saved successfully"),console.log("Allocations saved successfully",a.data.data.time_allocations);let l=b.value.findIndex(u=>u.employeeId==e.employeeId);b.value[l]={...e,timeAllocations:[...a.data.data.time_allocations]};let c=v.value.findIndex(u=>u.employeeId==e.employeeId);v.value[c]={...e,timeAllocations:[...a.data.data.time_allocations]},s.value.timeAllocations=[...a.data.data.time_allocations]}).catch(a=>{var l;alert("Error saving allocations"),console.error("Error saving allocations:",((l=a.response)==null?void 0:l.data)||a.message)}).finally(()=>{A.value=!1})}function F(o){s.value.timeAllocations.splice(o,1)}function Y(o,e){return _.includes(o)?0:e?`${e>100?100:e}%`:0}return q(g,o=>{const e=o.toLowerCase();b.value=v.value.filter(a=>a.name.toLowerCase().includes(e)||a.resno.toLowerCase().includes(e))}),Z(()=>{v.value=z.staff.map(o=>{var e;return{employeeId:o.employeeId,resno:o.resno||"N/A",name:((e=o==null?void 0:o.lastName)==null?void 0:e.toLowerCase())+" "+(o==null?void 0:o.name.toLowerCase()),position:o.position||"N/A",grade_level:o.grade_level||"N/A",grade:o.grade||"N/A",organization:o.organization||"N/A",country:o.country||"N/A",base_station:o.base_station||"N/A",division:o.division||"N/A",unit_program:o.unit_program||"N/A",supervisor:o.supervisor&&`${o.supervisor.firstName.toLowerCase()||""} ${o.supervisor.lastName.toLowerCase()||""}`.trim()||"N/A",timeAllocations:o.time_allocations}}),b.value=[...v.value]}),(o,e)=>(r(),n("div",ee,[e[7]||(e[7]=t("h1",{class:"text-xl font-bold mb-4"},"Staff Time Allocation",-1)),t("div",te,[t("div",oe,[L(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>K(g)?g.value=a:g=a),class:"border border-gray-300 p-2 rounded-lg w-full mb-3",type:"text",placeholder:"search...",name:"",id:""},null,512),[[H,i(g)]])]),t("div",le,[t("table",se,[t("thead",ae,[t("tr",null,[(r(),n(f,null,m(I,(a,l)=>t("th",{key:l,class:"px-4 py-2 border text-[11px] border-gray-300 text-left whitespace-nowrap"},p(a),1)),64))])]),t("tbody",null,[(r(!0),n(f,null,m(i(b),(a,l)=>(r(),n("tr",{key:l,class:"hover:bg-blue-100 cursor-pointer",onClick:c=>B(a)},[(r(),n(f,null,m(I,(c,u)=>t("td",{key:u,class:"px-4 py-3 border-b text-[12px] bg-white border-gray-200 whitespace-nowrap"},p(a[u]),1)),64))],8,ne))),128))])])])]),i(s)?(r(),n("div",re,[t("div",ie,[t("div",ce,[t("div",de,[t("h2",ue,[e[1]||(e[1]=h("Staff Time Allocation : ")),t("span",pe,p(i(s).name),1)]),t("h2",fe,[e[2]||(e[2]=h("Supervisor : ")),t("span",me,p(i(s).supervisor),1)]),t("h2",be,[e[3]||(e[3]=h("Year : ")),t("span",ve,p(new Date().getFullYear()),1)])]),t("button",{onClick:T,class:"p-2 absolute top-0 right-2 text-2xl cursor-pointer"},e[4]||(e[4]=[t("i",{class:"uil uil-times"},null,-1)])),t("button",{onClick:P,class:"p-1 px-2 mb-2 bg-green-500 text-white cursor-pointer rounded hover:bg-green-400"}," + Add new "),t("div",ge,[t("div",_e,[t("div",xe,[(r(),n(f,null,m(C,(a,l)=>t("div",he,[t("span",Ae,p(G(a,l)),1),k(V,{name:"fade-slide",mode:"out-in"},{default:D(()=>[(r(),n("span",{key:E(i(s).timeAllocations,a.toLocaleLowerCase())},p(E(i(s).timeAllocations,a.toLocaleLowerCase())),1))]),_:2},1024)])),64))])])])]),i(s).timeAllocations.length>0?(r(),n("div",we,[(r(!0),n(f,null,m(i(s).timeAllocations,(a,l)=>{var c,u,O,R;return r(),n("div",{class:"w-full",key:l},[t("div",ye,[t("div",{class:N(["flex w-full  items-start p-2 rounded-md  cursor-pointer  mb-2 hover:bg-blue-50",(u=(c=i(s).timeAllocations)==null?void 0:c[l])!=null&&u.id?"bg-gray-100 ":"bg-red-50"])},[(r(),n(f,null,m(C,(S,d)=>t("div",Ne,[t("label",Ie,p(S),1),t("div",Ce,[t("div",{class:"absolute inset-0 bg-green-300 transition-all duration-200 rounded",style:Q({width:Y(d,i(s).timeAllocations[l][d]),zIndex:0})},null,4),L(t("input",{type:d=="agreement"||d=="bus"?"text":"number",min:"0",max:"100",disabled:d=="total",class:N([[{"bg-yellow-400":d=="total"}],"relative z-10 w-full h-full border text-center text-sm border-gray-300 focus:outline-none focus:ring-2 focus:rounded-md focus:ring-green-500 focus:border-green-500"]),onInput:w=>U(w.target.value,l),"onUpdate:modelValue":w=>i(s).timeAllocations[l][d]=w},null,42,Te),[[W,i(s).timeAllocations[l][d]]])]),k(V,{name:"fade-slide",mode:"out-in"},{default:D(()=>[_.includes(d)?y("",!0):(r(),n("span",{key:i(s).timeAllocations[l][d],class:"text-[11px] font-bold block"},p(i(s).timeAllocations[l][d])+"% ",1))]),_:2},1024)])),64))],2),(R=(O=i(s).timeAllocations)==null?void 0:O[l])!=null&&R.id?y("",!0):(r(),n("button",{key:0,onClick:S=>F(l),type:"button",class:"p-1 cursor-pointer"},"x",8,Ee))])])}),128))])):(r(),n("div",Oe,e[5]||(e[5]=[t("span",null,"No Data",-1)]))),t("div",Re,[t("div",Se,[t("button",{class:"px-3 p-1 cursor-pointer bg-gray-100 border border-gray-300 rounded hover:bg-gray-400",onClick:T}," cancel "),t("button",{class:"px-3 py-1 cursor-pointer border-0 bg-blue-600 text-white rounded hover:bg-blue-700",onClick:$},[i(A)?(r(),n("div",Le,e[6]||(e[6]=[t("div",{class:"w-5 h-5 border-5 border-white border-t-transparent rounded-full animate-spin"},null,-1),h(" Processing...")]))):(r(),n("span",ke," Save now"))])])])])])):y("",!0)]))}},ze=X(De,[["__scopeId","data-v-2edea939"]]);export{ze as default};
