import{d as U,r as p,w as G,e as u,l as y,o as i,f as s,F as _,k as b,t as f,j as I,g as x,m as J,n as Y,T as K,c as O,p as q}from"./app-DRgljH5W.js";import{_ as H}from"./ItemTimeAllocationComponent.vue_vue_type_script_setup_true_lang-k2x1rfa6.js";import{_ as Q}from"./ButtonSaveComponent.vue_vue_type_script_setup_true_lang-D1Uc-PIi.js";import{_ as W}from"./ButtonEmailComponent.vue_vue_type_script_setup_true_lang-DGOTKE0E.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Z={class:"bg-white flex flex-col w-[100%] p-3 px-5 rounded-xl shadow-xl overflow-hidden max-h-[90vh]"},ee={key:0,class:"w-full py-10 text-center text-lg font-bold"},te={class:"w-full relative"},ae={class:"w-full flex items-center gap-2 text-[14px] py-3"},se={class:"font-semibold mb-4 uppercase"},le={class:"capitalize text-gray-600"},oe={class:"font-semibold mb-4 uppercase"},ne={class:"capitalize text-gray-600"},ie={class:"font-semibold mb-4 uppercase"},ce={class:"capitalize text-gray-600"},ue={key:1,class:"w-full flex items-center gap-2"},de={class:"borders flex gap-2 borders-gray-200 w-full"},re={class:"flex w-full items-start p-2 rounded-md cursor-pointer"},me={class:"font-bold"},fe={key:0,class:"flex-1 overflow-y-auto"},pe={key:1,class:"text-center flex flex-col items-center gap-2 mt-2 font-medium"},ge={class:"w-full"},ve={class:"mt-3 flex justify-end gap-2"},he=U({__name:"AllocationConmponent",props:{selectedRow:{},staffId:{}},emits:["update:selectedRow","close","save","delete","sendEmail"],setup(T,{emit:j}){const E=T,R=j,g=p(!1),N=p(null),o=p([]),r=p(null),S={agreement:"AGREEMENT",bus:"BUS",jan:"JAN",feb:"FEB",mar:"MAR",apr:"APR",may:"MAY",jun:"JUN",jul:"JUL",aug:"AUG",sep:"SEP",oct:"OCT",nov:"NOV",dec:"DEC",total:"Total"},k=["id","agreement","bus"],D=()=>({id:null,agreement:"",bus:"",jan:0,feb:0,mar:0,apr:0,may:0,jun:0,jul:0,aug:0,sep:0,oct:0,nov:0,dec:0,total:0}),M=()=>({id:null,jan:0,feb:0,mar:0,apr:0,may:0,jun:0,jul:0,aug:0,sep:0,oct:0,nov:0,dec:0,total:0}),v=async a=>{a&&(g.value=!0,window.axios.get("/staff/time-allocations/"+a).then(e=>{const{time_allocations:t,...l}=e.data.data;o.value=t,r.value=l}).catch(e=>{var t,l,n;alert(((l=(t=e.response)==null?void 0:t.data)==null?void 0:l.message)||e.message),console.error("Error saving allocations:",((n=e.response)==null?void 0:n.data)||e.message)}).finally(()=>{g.value=!1}))};G(()=>E.staffId,async a=>{a&&v(a)},{immediate:!0});const h=()=>{R("close"),o.value=null},w=()=>{o.value&&(o.value.unshift(D()),o.value.length===1&&(o.value.monthlyTotal=M()))},$=a=>{o.value&&o.value.splice(a,1)};function B(a){if(o.value.length===0)return alert("Please add a time allocation before submitting."),a(!0),!1;if(!confirm("Are you sure you want to save these changes?"))return a(!0),!1;let e={...o.value};window.axios.post("/time-allocations",{employeeId:r.value.employeeId,timeAllocations:e,monthlyTimeTotal:e.monthlyTotal}).then(async t=>{var l;await v(r.value.employeeId),alert(((l=t==null?void 0:t.data)==null?void 0:l.message)||(t==null?void 0:t.message))}).catch(t=>{var l,n,d;alert(((n=(l=t.response)==null?void 0:l.data)==null?void 0:n.message)||t.message),console.error("Error saving allocations:",((d=t.response)==null?void 0:d.data)||t.message)}).finally(()=>{a(!0)})}function P(a,e){if(!confirm("Are you sure you want to delete these changes?")){e(!0);return}N.value=a,axios.post("/time-delete",{employeeId:r.value.employeeId,id:a}).then(async t=>{await v(r.value.employeeId),alert("Allocations delete successfully")}).catch(t=>{var l,n,d;alert(((n=(l=t.response)==null?void 0:l.data)==null?void 0:n.message)||t.message),console.error("Error saving allocations:",((d=t.response)==null?void 0:d.data)||t.message)}).finally(()=>{e(!0)})}function z(a){if(o.value.length===0)return alert("Please add a time allocation before submitting."),a(!0),!1;if(!confirm("Do you really want to send this email?")){a(!0);return}axios.post("/send-mail",{employeeId:r.value.employeeId}).then(e=>{var t;alert(((t=e==null?void 0:e.data)==null?void 0:t.message)||(e==null?void 0:e.message))}).catch(e=>{var t;alert(((t=e==null?void 0:e.response.data)==null?void 0:t.message)||(e==null?void 0:e.message))}).finally(()=>{a(!0)})}const A=(a,e)=>k.includes(e)?"":a.reduce((t,l)=>{const n=Number(l[e])||0;return t+n},0),F=(a,e)=>["agreement","bus"].includes(e)?"":`${a}:`,V=(a,e)=>{const t=e==="total"?1200:100;return a<t?"bg-blue-500":a>t?"bg-red-500":"bg-green-300"};return(a,e)=>{var t,l,n,d,C;return a.staffId?(i(),u("div",{key:0,onClick:q(h,["self"]),class:"fixed p-10 w-full z-40 inset-0 bg-black/50 bg-opacity-50 flex items-center justify-center"},[s("div",Z,[g.value?(i(),u("div",ee," Loading... ")):(i(),u(_,{key:1},[s("div",te,[s("div",ae,[s("h2",se,[e[0]||(e[0]=b(" Staff: ")),s("span",le,f(((t=a.selectedRow)==null?void 0:t.name)+" "+((l=a.selectedRow)==null?void 0:l.lastName)),1)]),s("h2",oe,[e[1]||(e[1]=b(" Supervisor: ")),s("span",ne,f((n=a.selectedRow)==null?void 0:n.supervisor_name),1)]),s("h2",ie,[e[2]||(e[2]=b(" Year: ")),s("span",ce,f(new Date().getFullYear()),1)])]),s("button",{type:"button",onClick:h,class:"p-2 absolute top-0 right-2 text-2xl cursor-pointer"},e[3]||(e[3]=[s("i",{class:"uil uil-times"},null,-1)])),((d=o.value)==null?void 0:d.length)>0?(i(),u("button",{key:0,onClick:w,class:"p-1 px-2 mb-2 bg-green-500 text-white cursor-pointer rounded hover:bg-green-400"}," + Add new ")):y("",!0),o.value?(i(),u("div",ue,[s("div",de,[s("div",re,[(i(),u(_,null,I(S,(m,c)=>s("div",{class:"w-full flex items-center justify-center gap-1 text-[11px]",key:c},[s("span",me,f(F(m,c)),1),x(K,{name:"fade-slide",mode:"out-in"},{default:J(()=>[(i(),u("span",{class:Y([V(A(o.value,c),c),"px-1 font-medium"]),key:`${c}`},f(A(o.value,c)),3))]),_:2},1024)])),64))])])])):y("",!0)]),((C=o.value)==null?void 0:C.length)>0?(i(),u("div",fe,[(i(!0),u(_,null,I(o.value,(m,c)=>(i(),O(H,{key:m.id||c,allocation:m,onRemoveItem:L=>$(c),onDelete:L=>P(m.id,c)},null,8,["allocation","onRemoveItem","onDelete"]))),128))])):(i(),u("div",pe,[e[4]||(e[4]=s("span",null,"No Data",-1)),s("button",{onClick:w,class:"p-1 px-2 mb-2 max-w-max border border-green-500 text-green-500 cursor-pointer rounded"}," + Add new ")])),s("div",ge,[s("div",ve,[s("button",{class:"px-3 p-1 cursor-pointer bg-gray-100 border border-gray-300 rounded hover:bg-gray-400",onClick:h}," Cancel "),x(Q,{onSave:B}),x(W,{onSave:z})])])],64))])])):y("",!0)}}}),Ae=X(he,[["__scopeId","data-v-d4af3bfc"]]);export{Ae as default};
